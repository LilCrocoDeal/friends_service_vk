# Документация проекта Friends Service
## Запуск
Для запуска необходимо скачать [Dockerfile](../FriendsService/Dockerfile), запустить docker и написать в терминал команду из директории, в которую он был скачан

`docker build -t friends_service .`

Будет создан образ __friends_service__, который можно будет запустить при помощи ввода в консоль

`docker run -p 8080:8000 -it --name fs friends_service`

Теперь приложение должно стать доступно в браузере по адресу `127.0.0.1:8080`, однако, чтобы сразу получить доступ к функционалу, имеет смысл  перейти 
по адресу `127.0.0.1:8080/swagger/`.

При переходе пользователь попадает в спецификацию __OpenAPI__ по данному проекту.
## OpenAPI
Основой для написания спецификации использовалась python-библиотека __drf-yasg__, которая предоставляет базовую самогенерирующуюся OpenAPI спацификацию.
Конечно, основные методы и запросы были описаны дополнительно вручную. 

Спецификация написана полностью на английском языке, но вполне доступном для обычного пользователя. Способы использования сервиса были изложены в 
основном описании, однако все еще стоит подчекнуть, что:
- Пользователь может регистрироваться и авторизовываться по токену, все взаимодействия возможны только с корректным токеном авторизации в заголовке 
запроса (который прописывается в поле Authorize после получения). 
- Пользователь может отправлять запросы в друзья любому из существующих пользователей на сайте (кроме самого себя) и получать информацию о своих взаимоотношениях 
с ним.
- Пользователь может просмотреть заявки в друзья и принять или отклонить какую-либо заявку. Если пользователь соглашается, то отправитель оказывается 
в друзьях с пользователем.
- Пользователь может посмотреть список своих друзей и удалить кого-либо из него по мере необходимости.

## Нюансы взаимодействия
Если пользователь отклонил заявку в друзья, она не удаляется, а остается в заявках со статусом "отклонено". Так как в ТЗ ничего не было сказано про этот момент, 
было решено сделать это подобным образом для того, чтобы отправитель запроса не спамил повторными заявками в друзья.

Пользователь в любой момент может принять отклоненную заявку в друзья, сделав отправившего своим другом. Если же пользователь удаляет кого-то из списка 
друзей, то у него в заявках автоматически появляется запрос от этого друга со статусом "отклонено".

Чтобы избежать проблем с тем, что отклоненные заявки копятся в базе заявок, есть возможность по адресу `/requests/delete/` вручную полностью удалить 
заявку от определенного пользователя из списка заявок.

Как и требовалось, если пользователь отправляет заявку в ответ на уже полученную, он с адресатом оказываются друг у друга в друзьях.

Регистрация и авторизация по токенам были написаны вручную на основе предоставляемых возможностей rest_framework.

Спецификация OpenAPI была написана так, чтобы только по ней можно было взаимодействовать знающему пользователю с реализованным сервисом. К каждому методу, 
требуемому в ТЗ, было написано лаконичное описание.

Код проекта я старался писать понятно, чтобы не было проблем с его чтением.

## Пример использования
Перейдем по адресу `127.0.0.1:8080/swagger/`.

Создадим нового пользователя через `/account/registration/`.
```json
{
  "username": "friendly_bob",
  "password": "bob55555"
}
```
Введем его данные в `/account/login/`, залогинимся и получим в ответ токен
```json
{
  "token": "e6b1308ba2ed04076f6d1fa0820c96055907cca9"
}
```
Скопировав его, введем его в поле __Authorize__ в формате `Token e6b1308ba2ed04076f6d1fa0820c96055907cca9`. Теперь, при запросах на сервер, у нас в
header'е всегда будет правильный токен.

Посмотрим в свой список запросов в друзья `/requests/`
```json
[]
```
Разлогинимся за данного пользователя, и с трех других тестовых 
пользователей отправим ему запросы в друзья через `/requests/send/`. Теперь, снова посмотрев `/requests/`, мы увидим
```json
[
  {
    "from_user": "croc",
    "to_user": "friendly_bob",
    "status": "has been sent"
  },
  {
    "from_user": "pablo",
    "to_user": "friendly_bob",
    "status": "has been sent"
  },
  {
    "from_user": "plebeb",
    "to_user": "friendly_bob",
    "status": "has been sent"
  }
]
```
Отклоним заявки _pablo_ и _plebeb_'a, а заявку _croc_'а примем во вкладке `/requests/manage/`. Получив положительные ответы от сервера о рассортировке заявок, 
мы увидим, что отклоненные заявки остались в `/requests/`, но их статус изменился
```json
[
  {
    "from_user": "pablo",
    "to_user": "friendly_bob",
    "status": "rejected by receiver"
  },
  {
    "from_user": "plebeb",
    "to_user": "friendly_bob",
    "status": "rejected by receiver"
  }
]
```
В то время как _croc_ оказался в друзьях (`/friends/`)
```json
[
  {
    "friend": "croc"
  }
]
```
Решим принять одну из отклоненных заявок, например, _pablo_, в `/requests/manage/`, и теперь он тоже окажется у нас в друзьях
```json
[
  {
    "friend": "croc"
  },
  {
    "friend": "pablo"
  }
]
```
Удалим из друзей _croc_'а при помощи `/friends/delete`. Теперь его заявка висит как отклоненная пользователем в `/requests` и он не может попытаться нашего 
пользователя снова добавить в друзья. Параллельно отправим заявку `/requests/send/` в друзья еще одному пользователю и посмотрим наш список заявок
```json
[
  {
    "from_user": "plebeb",
    "to_user": "friendly_bob",
    "status": "rejected by receiver"
  },
  {
    "from_user": "croc",
    "to_user": "friendly_bob",
    "status": "rejected by receiver"
  },
  {
    "from_user": "friendly_bob",
    "to_user": "mytimofeev",
    "status": "has been sent"
  }
]
```
Как мы видим, отображаются все входящие и исходящие заявки. Отправим перекрестную заявку в друзья _plebeb_'у (`/request/send/`), и посмотрим список друзей:
```json
[
  {
    "friend": "pablo"
  },
  {
    "friend": "plebeb"
  }
]
```
Соответственно, он был добавлен, в то же время он был убран из заявок:
```json
[
  {
    "from_user": "croc",
    "to_user": "friendly_bob",
    "status": "rejected by receiver"
  },
  {
    "from_user": "friendly_bob",
    "to_user": "mytimofeev",
    "status": "has been sent"
  }
]
```
Посмотрим информацию о себе в `/info`. Нам выведут ответ
```json
{
  "detail": "This user is you"
}
```
При запросе информации уже о другом пользователе, например, _pablo_, мы узнаем, что
```json
{
  "detail": "You are friends with this user"
}
```
Удалим отклоненную заявку в друзья от пользователя _croc_, воспользовавшись `/requests/delete/` и получим ответ
```json
{
  "detail": "The request has been successfully removed"
}
```
Проверим список заявок для нашего пользователя:
```json
[
  {
    "from_user": "friendly_bob",
    "to_user": "mytimofeev",
    "status": "has been sent"
  }
]
```
Все удалено корректно.
